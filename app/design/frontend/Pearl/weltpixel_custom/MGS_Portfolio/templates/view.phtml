<?php
/** @var \Magento\Framework\App\ObjectManager $om */
$om = \Magento\Framework\App\ObjectManager::getInstance();
/** @var \Magento\Framework\App\Http\Context $context */
$context = $om->get('Magento\Framework\App\Http\Context');
/** @var bool $isLoggedIn */
$isLoggedIn = $context->getValue(\Magento\Customer\Model\Context::CONTEXT_AUTH);

$portfolio = $this->getPortfolio();
?>
<div class="row portfolio-details">

    <div class="col-md-8 col-sm-7 col-xs-12">
        <div data-slider-id="1" class="<?= ($this->getGalleryImage1($portfolio) || $this->getGalleryImage2($portfolio) || $this->getGalleryImage3($portfolio) || $this->getGalleryImage4($portfolio) || $this->getGalleryImage5($portfolio))? 'owl-carousel owl-theme' : false?>">
            <div class="portfolio-image">
                <img src="<?php echo $this->getBaseImage($portfolio)?>" alt="" class="img-responsive"/>
            </div>
            <?php if($this->getGalleryImage1($portfolio)):?>
                <div class="portfolio-image">
                    <img src="<?php echo $this->getGalleryImage1($portfolio)?>" alt="" class="img-responsive"/>
                </div>
            <?php endif; ?>

            <?php if($this->getGalleryImage2($portfolio)):?>
                <div class="portfolio-image">
                    <img src="<?php echo $this->getGalleryImage2($portfolio)?>" alt="" class="img-responsive"/>
                </div>
            <?php endif; ?>

            <?php if($this->getGalleryImage3($portfolio)):?>
                <div class="portfolio-image">
                    <img src="<?php echo $this->getGalleryImage3($portfolio)?>" alt="" class="img-responsive"/>
                </div>
            <?php endif; ?>

            <?php if($this->getGalleryImage4($portfolio)):?>
                <div class="portfolio-image">
                    <img src="<?php echo $this->getGalleryImage4($portfolio)?>" alt="" class="img-responsive"/>
                </div>
            <?php endif; ?>

            <?php if($this->getGalleryImage5($portfolio)):?>
                <div class="portfolio-image">
                    <img src="<?php echo $this->getGalleryImage5($portfolio)?>" alt="" class="img-responsive"/>
                </div>
            <?php endif; ?>
        </div>
        <?php if($this->getGalleryImage1($portfolio) || $this->getGalleryImage2($portfolio) || $this->getGalleryImage3($portfolio) || $this->getGalleryImage4($portfolio)):?>
            <div data-slider-id="1" class="<?= ($this->getGalleryImage1($portfolio) || $this->getGalleryImage2($portfolio) || $this->getGalleryImage3($portfolio) || $this->getGalleryImage4($portfolio) || $this->getGalleryImage5($portfolio))? 'owl-thumbs' : false?>">
                <button class="owl-thumb-item">
                    <img src="<?php echo $this->getBaseImage($portfolio)?>" alt="" class="img-responsive"/>
                </button>
                <?php if($this->getGalleryImage1($portfolio)):?>
                    <button class="owl-thumb-item">
                        <img src="<?php echo $this->getGalleryImage1($portfolio)?>" alt="" class="img-responsive"/>
                    </button>
                <?php endif; ?>

                <?php if($this->getGalleryImage2($portfolio)):?>
                    <button class="owl-thumb-item">
                        <img src="<?php echo $this->getGalleryImage2($portfolio)?>" alt="" class="img-responsive"/>
                    </button>
                <?php endif; ?>

                <?php if($this->getGalleryImage3($portfolio)):?>
                    <button class="owl-thumb-item">
                        <img src="<?php echo $this->getGalleryImage3($portfolio)?>" alt="" class="img-responsive"/>
                    </button>
                <?php endif; ?>

                <?php if($this->getGalleryImage4($portfolio)):?>
                    <button class="owl-thumb-item">
                        <img src="<?php echo $this->getGalleryImage4($portfolio)?>" alt="" class="img-responsive"/>
                    </button>
                <?php endif; ?>

                <?php if($this->getGalleryImage5($portfolio)):?>
                    <button class="owl-thumb-item">
                        <img src="<?php echo $this->getGalleryImage5($portfolio)?>" alt="" class="img-responsive"/>
                    </button>
                <?php endif; ?>
            </div>
        <?php endif; ?>
        <!--        <div class="sharethis-inline-share-buttons"></div>-->
    </div>

    <div class="col-md-4 col-sm-5 col-xs-12">
        <div class="portfolio-content">
            <h1 style="font-size:40px; margin-bottom:25px"><?php echo $portfolio->getName() ?></h1>
            <div class="description"><?php echo nl2br($portfolio->getDescription()) ?></div>
            <table class="table portfolio-table">
                <tbody>
                <?php $date = $portfolio->getPortfolioDate() ?>
                <?php if($date != ''): ?>
                    <tr>
                        <td><?php echo __('Date:') ?></td>
                        <td><?php echo date('F d, Y', strtotime($date))?></td>
                    </tr>
                <?php endif ?>

                <?php $service = $portfolio->getServices() ?>
                <?php if($service != ''): ?>
                    <tr>
                        <td><?php echo __('Project:') ?></td>
                        <td><a href="<?php echo $portfolio->getProjectUrl() ?>" target="_blank"><?php echo $service ?></a></td>
                    </tr>
                <?php endif ?>

                <?php $client = $portfolio->getClient() ?>
                <?php if($client != ''): ?>
                    <tr>
                        <td><?php echo __('Client:') ?></td>
                        <td><?php echo $client ?></td>
                    </tr>
                <?php endif ?>

                <?php $skills = $portfolio->getSkills() ?>
                <?php if($skills != ''): ?>
                    <tr>
                        <td><?php echo __('Skills:') ?></td>
                        <td><?php echo $skills ?></td>
                    </tr>
                <?php endif ?>
                <?php $categoryLinks = $this->getCategoriesLink($portfolio) ?>
                <?php if($categoryLinks != ''): ?>
                    <tr>
                        <td><?php echo __('Categories:') ?></td>
                        <td><?php echo $categoryLinks ?></td>
                    </tr>
                <?php endif ?>
                </tbody>
            </table>
            <div class="portfolio_item__back-to-gallery">
                <a href="/portfolio" class="portfolio_item__back-to-gallery_a">Back to Gallery</a>
            </div>
        </div>
    </div>
</div>
<div class="portfolio-form-block">
    <div class="portfolio-form-header">
        <h2><?= /* @escapeNotVerified */ __('Look for something similar?') ?></h2>
        <p><?= /* @escapeNotVerified */ __('Call us on UK ')?><a href="tel:01288350620"><?= __('01288 350620')?></a><?= __(' or use our contact form to get in touch.')?></p>
    </div>
    <div class="portfolio-form-not-logged">
        <button type="button" onclick="location.href='/contact'"  title="<?=  /* @escapeNotVerified */ __('Please Login') ?>" ><span><?php echo "Request Quote" ?></span></button>
    </div>
</div>

<script type="text/javascript">
    require([
        'jquery',
        'owlcarousel'
    ], function($, owlcarousel){
        $(document).ready(function () {
            <?php if($this->getGalleryImage1($portfolio) || $this->getGalleryImage2($portfolio) || $this->getGalleryImage3($portfolio) || $this->getGalleryImage4($portfolio)):?>
            /*! owl.carousel2.thumbs - v0.1.8 | (c) 2016 @gijsroge | MIT license | https://github.com/gijsroge/OwlCarousel2-Thumbs */
            /**
             * Thumbs Plugin
             * @version 2.0.0
             * @author Gijs RogÃ©
             * @license The MIT License (MIT)
             */
            (function ($, window, document, undefined) {
                'use strict';

                /**
                 * Creates the thumbs plugin.
                 * @class The thumbs Plugin
                 * @param {Owl} carousel - The Owl Carousel
                 */
                var Thumbs = function (carousel) {


                    /**
                     * Reference to the core.
                     * @protected
                     * @type {Owl}
                     */
                    this.owl = carousel;


                    /**
                     * All DOM elements for thumbnails
                     * @protected
                     * @type {Object}
                     */
                    this._thumbcontent = [];


                    /**
                     * Instance identiefier
                     * @type {number}
                     * @private
                     */
                    this._identifier = 0;


                    /**
                     * Return current item regardless of clones
                     * @protected
                     * @type {Object}
                     */
                    this.owl_currentitem = this.owl.options.startPosition;


                    /**
                     * The carousel element.
                     * @type {jQuery}
                     */
                    this.$element = this.owl.$element;


                    /**
                     * All event handlers.
                     * @protected
                     * @type {Object}
                     */
                    this._handlers = {
                        'prepared.owl.carousel': $.proxy(function (e) {
                            if (e.namespace && this.owl.options.thumbs && !this.owl.options.thumbImage && !this.owl.options.thumbsPrerendered && !this.owl.options.thumbImage) {
                                if ($(e.content).find('[data-thumb]').attr('data-thumb') !== undefined) {
                                    this._thumbcontent.push($(e.content).find('[data-thumb]').attr('data-thumb'));
                                }
                            } else if (e.namespace && this.owl.options.thumbs && this.owl.options.thumbImage) {
                                var innerImage = $(e.content).find('img');
                                this._thumbcontent.push(innerImage);
                            }
                        }, this),

                        'initialized.owl.carousel': $.proxy(function (e) {
                            if (e.namespace && this.owl.options.thumbs) {
                                this.render();
                                this.listen();
                                this._identifier = this.owl.$element.data('slider-id');
                                this.setActive();
                            }
                        }, this),

                        'changed.owl.carousel': $.proxy(function (e) {
                            if (e.namespace && e.property.name === 'position' && this.owl.options.thumbs) {
                                this._identifier = this.owl.$element.data('slider-id');
                                this.setActive();
                            }
                        }, this)
                    };

                    // set default options
                    this.owl.options = $.extend({}, Thumbs.Defaults, this.owl.options);

                    // register the event handlers
                    this.owl.$element.on(this._handlers);
                };


                /**
                 * Default options.
                 * @public
                 */
                Thumbs.Defaults = {
                    thumbs: true,
                    thumbImage: false,
                    thumbContainerClass: 'owl-thumbs',
                    thumbItemClass: 'owl-thumb-item',
                    moveThumbsInside: false
                };


                /**
                 * Listen for thumbnail click
                 * @protected
                 */
                Thumbs.prototype.listen = function () {

                    //set default options
                    var options = this.owl.options;

                    if (options.thumbsPrerendered) {
                        this._thumbcontent._thumbcontainer = $('.' + options.thumbContainerClass);
                    }

                    //check what thumbitem has been clicked and move slider to that item
                    $(this._thumbcontent._thumbcontainer).on('click', this._thumbcontent._thumbcontainer.children(), $.proxy(function (e) {

                        // find relative slider
                        this._identifier = $(e.target).closest('.' + options.thumbContainerClass).data('slider-id');

                        // get index of clicked thumbnail
                        var index = $(e.target).parent().is(this._thumbcontent._thumbcontainer) ? $(e.target).index() : $(e.target).closest('.'+options.thumbItemClass).index();

                        if (options.thumbsPrerendered) {
                            // slide to slide :)
                            $('[data-slider-id=' + this._identifier + ']').trigger('to.owl.carousel', [index, options.dotsSpeed, true]);
                        } else {
                            this.owl.to(index, options.dotsSpeed);
                        }

                        e.preventDefault();
                    }, this));
                };


                /**
                 * Builds thumbnails
                 * @protected
                 */
                Thumbs.prototype.render = function () {

                    //set default options
                    var options = this.owl.options;

                    //create thumbcontainer
                    if (!options.thumbsPrerendered) {
                        this._thumbcontent._thumbcontainer = $('<div>').addClass(options.thumbContainerClass).appendTo(this.$element);
                    } else {
                        this._thumbcontent._thumbcontainer = $('.' + options.thumbContainerClass + '');
                        if(options.moveThumbsInside){
                            this._thumbcontent._thumbcontainer.appendTo(this.$element);
                        }
                    }

                    //create thumb items
                    var i;
                    if (!options.thumbImage) {
                        for (i = 0; i < this._thumbcontent.length; ++i) {
                            this._thumbcontent._thumbcontainer.append('<button class=' + options.thumbItemClass + '>' + this._thumbcontent[i] + '</button>');
                        }
                    } else {
                        for (i = 0; i < this._thumbcontent.length; ++i) {
                            this._thumbcontent._thumbcontainer.append('<button class=' + options.thumbItemClass + '><img src="' + this._thumbcontent[i].attr('src') + '" alt="' + this._thumbcontent[i].attr('alt') + '" /></button>');
                        }
                    }
                };


                /**
                 * Updates active class on thumbnails
                 * @protected
                 */
                Thumbs.prototype.setActive = function () {

                    // get startslide
                    this.owl_currentitem = this.owl._current - (this.owl._clones.length / 2);
                    if (this.owl_currentitem === this.owl._items.length) {
                        this.owl_currentitem = 0;
                    }

                    //set default options
                    var options = this.owl.options;

                    // set relative thumbnail container
                    var thumbContainer = options.thumbsPrerendered ? $('.' + options.thumbContainerClass + '[data-slider-id="' + this._identifier + '"]') : this._thumbcontent._thumbcontainer;
                    thumbContainer.children().filter('.active').removeClass('active');
                    thumbContainer.children().eq(this.owl_currentitem).addClass('active');
                };


                /**
                 * Destroys the plugin.
                 * @public
                 */
                Thumbs.prototype.destroy = function () {
                    var handler, property;
                    for (handler in this._handlers) {
                        this.owl.$element.off(handler, this._handlers[handler]);
                    }
                    for (property in Object.getOwnPropertyNames(this)) {
                        typeof this[property] !== 'function' && (this[property] = null);
                    }
                };

                $.fn.owlCarousel.Constructor.Plugins.Thumbs = Thumbs;

            })(window.Zepto || window.jQuery, window, document);
            <?php endif; ?>
            $('.owl-carousel').owlCarousel({
                loop:true,
                margin:10,
                nav:false,
                dots:false,
                items: 1,
                <?php if($this->getGalleryImage1($portfolio) || $this->getGalleryImage2($portfolio) || $this->getGalleryImage3($portfolio) || $this->getGalleryImage4($portfolio)):?>
                thumbs: true,
                thumbsPrerendered: true
                <?php endif; ?>
            });
        });
    });
</script>

<!--<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5e389a370fe1110012ac8e30&product=inline-share-buttons&cms=website' async='async'></script>-->
<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5f303d38de52a0001208d72a&product=sop' async='async'></script>