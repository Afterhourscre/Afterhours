<?xml version="1.0"?>
<!--
/**
* Copyright 2019 aheadWorks. All rights reserved.
See LICENSE.txt for license details.
*/
-->

<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="Aheadworks\OnSale\Model\Label\Renderer\Placement\ConfigInterface" type="Aheadworks\OnSale\Model\Label\Renderer\Placement\Config" />
    <preference for="Aheadworks\OnSale\Api\Data\RuleInterface" type="Aheadworks\OnSale\Model\Rule" />
    <preference for="Aheadworks\OnSale\Api\Data\RuleSearchResultsInterface" type="Magento\Framework\Api\SearchResults" />
    <preference for="Aheadworks\OnSale\Api\Data\ConditionInterface" type="Aheadworks\OnSale\Model\Rule\Condition" />
    <preference for="Aheadworks\OnSale\Api\RuleRepositoryInterface" type="Aheadworks\OnSale\Model\RuleRepository" />
    <preference for="Aheadworks\OnSale\Api\Data\LabelInterface" type="Aheadworks\OnSale\Model\Label" />
    <preference for="Aheadworks\OnSale\Api\Data\BlockInterface" type="Aheadworks\OnSale\Model\Label\Block" />
    <preference for="Aheadworks\OnSale\Api\LabelRepositoryInterface" type="Aheadworks\OnSale\Model\LabelRepository" />
    <preference for="Aheadworks\OnSale\Api\BlockRepositoryInterface" type="Aheadworks\OnSale\Model\Label\BlockRepository" />
    <preference for="Aheadworks\OnSale\Api\Data\LabelSearchResultsInterface" type="Magento\Framework\Api\SearchResults" />
    <preference for="Aheadworks\OnSale\Api\Data\LabelTextInterface" type="Aheadworks\OnSale\Model\Rule\LabelText" />
    <preference for="Aheadworks\OnSale\Api\Data\LabelTextStoreValueInterface" type="Aheadworks\OnSale\Model\Rule\LabelText\StoreValue" />
    <type name="Magento\Framework\EntityManager\MetadataPool">
        <arguments>
            <argument name="metadata" xsi:type="array">
                <item name="Aheadworks\OnSale\Api\Data\LabelInterface" xsi:type="array">
                    <item name="entityTableName" xsi:type="string">aw_onsale_label</item>
                    <item name="identifierField" xsi:type="string">label_id</item>
                </item>
                <item name="Aheadworks\OnSale\Api\Data\RuleInterface" xsi:type="array">
                    <item name="entityTableName" xsi:type="string">aw_onsale_rule</item>
                    <item name="identifierField" xsi:type="string">rule_id</item>
                </item>
            </argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Block\Label\Renderer\Label">
        <arguments>
            <argument name="layoutProcessors" xsi:type="array">
                <item name="common" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Layout\Processor\Common</item>
                <item name="pictureInfo" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Layout\Processor\PictureInfo</item>
            </argument>
        </arguments>
    </type>
    <type name="Magento\Framework\View\Element\UiComponent\DataProvider\CollectionFactory">
        <arguments>
            <argument name="collections" xsi:type="array">
                <item name="aw_onsale_rule_listing_data_source" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Rule\Grid\Collection</item>
                <item name="aw_onsale_label_listing_data_source" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Label\Grid\Collection</item>
            </argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Model\ResourceModel\Rule\Grid\Collection">
        <arguments>
            <argument name="mainTable" xsi:type="string">aw_onsale_rule</argument>
            <argument name="eventPrefix" xsi:type="string">aw_onsale_rule_grid_collection</argument>
            <argument name="eventObject" xsi:type="string">rule_grid_collection</argument>
            <argument name="resourceModel" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Rule</argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Model\ResourceModel\Label\Grid\Collection">
        <arguments>
            <argument name="mainTable" xsi:type="string">aw_onsale_label</argument>
            <argument name="eventPrefix" xsi:type="string">aw_onsale_label_grid_collection</argument>
            <argument name="eventObject" xsi:type="string">label_grid_collection</argument>
            <argument name="resourceModel" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Label</argument>
        </arguments>
    </type>
    <type name="Magento\Framework\EntityManager\Operation\ExtensionPool">
        <arguments>
            <argument name="extensionActions" xsi:type="array">
                <item name="Aheadworks\OnSale\Api\Data\RuleInterface" xsi:type="array">
                    <item name="create" xsi:type="array">
                        <item name="websiteCreator" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Rule\Relation\Website\SaveHandler</item>
                        <item name="labelTextCreator" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Rule\Relation\LabelText\SaveHandler</item>
                    </item>
                    <item name="read" xsi:type="array">
                        <item name="websiteReader" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Rule\Relation\Website\ReadHandler</item>
                        <item name="labelTextReader" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Rule\Relation\LabelText\ReadHandler</item>
                    </item>
                    <item name="update" xsi:type="array">
                        <item name="websiteUpdater" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Rule\Relation\Website\SaveHandler</item>
                        <item name="labelTextUpdater" xsi:type="string">Aheadworks\OnSale\Model\ResourceModel\Rule\Relation\LabelText\SaveHandler</item>
                    </item>
                </item>
            </argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Model\Rule\Validator\General">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="base" xsi:type="object">Aheadworks\OnSale\Model\Rule\Validator\Base</item>
                <item name="date" xsi:type="object">Aheadworks\OnSale\Model\Rule\Validator\Date</item>
                <item name="labelText" xsi:type="object">Aheadworks\OnSale\Model\Rule\Validator\LabelText</item>
            </argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Controller\Adminhtml\Rule\PostDataProcessor">
        <arguments>
            <argument name="processors" xsi:type="array">
                <item name="date" xsi:type="object">Aheadworks\OnSale\Controller\Adminhtml\Rule\PostDataProcessor\Date</item>
                <item name="productCondition" xsi:type="object">Aheadworks\OnSale\Controller\Adminhtml\Rule\PostDataProcessor\ProductCondition</item>
                <item name="labelText" xsi:type="object">Aheadworks\OnSale\Controller\Adminhtml\Rule\PostDataProcessor\LabelText</item>
                <item name="website" xsi:type="object">Aheadworks\OnSale\Controller\Adminhtml\Rule\PostDataProcessor\Website</item>
            </argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Controller\Adminhtml\Label\PostDataProcessor">
        <arguments>
            <argument name="processors" xsi:type="array">
                <item name="image" xsi:type="object">Aheadworks\OnSale\Controller\Adminhtml\Label\PostDataProcessor\Image</item>
                <item name="shape" xsi:type="object">Aheadworks\OnSale\Controller\Adminhtml\Label\PostDataProcessor\Shape</item>
            </argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Model\Rule\ObjectDataProcessor">
        <arguments>
            <argument name="processors" xsi:type="array">
                <item name="customerGroup" xsi:type="object">Aheadworks\OnSale\Model\Rule\ObjectDataProcessors\CustomerGroup</item>
                <item name="productCondition" xsi:type="object">Aheadworks\OnSale\Model\Rule\ObjectDataProcessors\ProductCondition</item>
            </argument>
        </arguments>
    </type>
    <type name="Magento\Catalog\Block\Product\Image">
        <plugin name="awOnSale" type="Aheadworks\OnSale\Plugin\Block\Product\ImagePlugin" />
    </type>
    <type name="Magento\Catalog\Block\Product\ImageBuilder">
        <plugin name="awOnSale" type="Aheadworks\OnSale\Plugin\Block\Product\ImageBuilderPlugin" />
    </type>
    <type name="Magento\CatalogInventory\Model\Indexer\Stock\Action\Rows">
        <plugin name="awOnSaleStockUpdateRows" type="Aheadworks\OnSale\Plugin\Indexer\Stock\UpdateRowsPlugin" />
    </type>
    <type name="Magento\Quote\Model\Cart\Totals\ItemConverter">
        <plugin name="awOnSaleCheckoutLabelRendering" type="Aheadworks\OnSale\Plugin\Model\Cart\Totals\ItemConverterPlugin"/>
    </type>
    <type name="Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor">
        <arguments>
            <argument name="processors" xsi:type="array">
                <item name="attribute" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\AttributeProcessor</item>
                <item name="save_percent" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\SavePercentProcessor</item>
                <item name="save_amount" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\SaveAmountProcessor</item>
                <item name="price" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\PriceProcessor</item>
                <item name="special_price" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\SpecialPriceProcessor</item>
                <item name="stock" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\StockProcessor</item>
                <item name="br" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\BrProcessor</item>
                <item name="sku" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\SkuProcessor</item>
                <item name="spdl" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\SpdlProcessor</item>
                <item name="sphl" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\SphlProcessor</item>
            </argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Model\ResourceModel\Rule\ProductType\AttributeProcessor">
        <arguments>
            <argument name="processors" xsi:type="array">
                <item name="stock" xsi:type="array">
                    <item name="default" xsi:type="object">Aheadworks\OnSale\Model\ResourceModel\Rule\ProductType\Operation\Stock\DefaultType</item>
                    <item name="bundle" xsi:type="object">Aheadworks\OnSale\Model\ResourceModel\Rule\ProductType\Operation\Stock\Bundle</item>
                    <item name="configurable" xsi:type="object">Aheadworks\OnSale\Model\ResourceModel\Rule\ProductType\Operation\Stock\Configurable</item>
                    <item name="grouped" xsi:type="object">Aheadworks\OnSale\Model\ResourceModel\Rule\ProductType\Operation\Stock\Grouped</item>
                </item>
            </argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\ProductType\PriceProcessor">
        <arguments>
            <argument name="processors" xsi:type="array">
                <item name="default" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\ProductType\Price\DefaultType</item>
                <item name="configurable" xsi:type="object">Aheadworks\OnSale\Model\Label\Block\Rule\Label\VariableProcessor\ProductType\Price\Configurable</item>
            </argument>
        </arguments>
    </type>
    <type name="Magento\Catalog\Ui\DataProvider\Product\ProductRenderCollectorComposite">
        <arguments>
            <argument name="productProviders" xsi:type="array">
                <item name="aw_onsale_label" xsi:type="object">Aheadworks\OnSale\Ui\DataProvider\Product\Listing\Collector\Label</item>
            </argument>
        </arguments>
    </type>

    <type name="Aheadworks\OnSale\Controller\Adminhtml\Rule\PostDataProcessor\ProductCondition">
        <arguments>
            <argument name="serializer" xsi:type="object">Magento\Framework\Serialize\Serializer\Serialize</argument>
        </arguments>
    </type>
    <type name="Aheadworks\OnSale\Model\Rule\ObjectDataProcessors\ProductCondition">
        <arguments>
            <argument name="serializer" xsi:type="object">Magento\Framework\Serialize\Serializer\Serialize</argument>
        </arguments>
    </type>
</config>
