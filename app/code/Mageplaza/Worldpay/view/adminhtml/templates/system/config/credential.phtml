<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_Worldpay
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

/** @var \Mageplaza\Worldpay\Block\Adminhtml\Backend\Credential $block */
?>

<?= $block->getButtonHtml() ?>

<span class="no-display" id="mpworldpay-spinner">
    <img alt="spinner" src="<?= $block->escapeUrl($block->getViewFileUrl('images/process_spinner.gif')) ?>"/>
</span>

<div id="mpworldpay-messages"></div>

<script type="text/javascript">
    require(['jquery'], function ($) {
        $('#mpworldpay-test-button').click(function () {
            $(this).addClass('disabled');

            var url  = '<?= $block->escapeUrl($block->getAjaxUrl()) ?>',
                data = {
                    'service_key': $('#payment_gb_mpworldpay_credentials_service_key').val(),
                    'client_key': $('#payment_gb_mpworldpay_credentials_client_key').val()
                };

            $('#mpworldpay-spinner').removeClass('no-display');

            $.ajax({
                method: 'POST',
                url: url,
                data: data,
                success: function (response) {
                    $('#mpworldpay-test-button').removeClass('disabled');
                    $('#mpworldpay-spinner').addClass('no-display');
                    var message = '<div class="message message-' + response.type + ' ' + response.type + ' ">' +
                        '<span>' + response.message + '</span>' +
                        '</div>';
                    $('#mpworldpay-messages').html(message);
                }
            });
        });
    });
</script>